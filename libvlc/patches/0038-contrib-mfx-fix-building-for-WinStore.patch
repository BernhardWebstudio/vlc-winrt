From 5d87e6c69abba53a7d3d4e96fe2fbe128f06d8db Mon Sep 17 00:00:00 2001
From: Steve Lhomme <robux4@ycbcr.xyz>
Date: Wed, 6 Mar 2019 13:08:06 +0100
Subject: [PATCH 38/40] contrib: mfx: fix building for WinStore

(cherry picked from commit 7ef64712d411c7d621e92e9753224f8b9c1f7086)
---
 contrib/src/mfx/rules.mak | 12 ++++++++++--
 1 file changed, 10 insertions(+), 2 deletions(-)

diff --git a/contrib/src/mfx/rules.mak b/contrib/src/mfx/rules.mak
index 2b4fbad702..bef7aa37a6 100644
--- a/contrib/src/mfx/rules.mak
+++ b/contrib/src/mfx/rules.mak
@@ -1,7 +1,7 @@
 # mfx (Media SDK)
 
 mfx_GITURL := https://github.com/lu-zero/mfx_dispatch.git
-MFX_GITHASH := b3b0bc9524a8a936fb1b80ca2db45566feb2e868
+MFX_GITHASH := 612558419be4889ac6d059516457e83c163edcd2
 
 ifeq ($(call need_pkg,"mfx"),)
 PKGS_FOUND += mfx
@@ -10,6 +10,14 @@ ifdef HAVE_WIN32
 PKGS += mfx
 endif
 
+MFX_CFLAGS := $(CFLAGS)
+MFX_CXXFLAGS := $(CFLAGS)
+
+ifdef HAVE_WINSTORE
+MFX_CFLAGS   += -DMEDIASDK_UWP_LOADER -DMEDIASDK_UWP_PROCTABLE
+MFX_CXXFLAGS += -DMEDIASDK_UWP_LOADER -DMEDIASDK_UWP_PROCTABLE
+endif
+
 $(TARBALLS)/mfx-$(MFX_GITHASH).tar.xz:
 	$(call download_git,$(mfx_GITURL),,$(MFX_GITHASH))
 
@@ -23,6 +31,6 @@ mfx: mfx-$(MFX_GITHASH).tar.xz .sum-mfx
 	$(MOVE)
 
 .mfx: mfx
-	cd $< && $(HOSTVARS) ./configure $(HOSTCONF)
+	cd $< && $(HOSTVARS) CFLAGS="$(MFX_CFLAGS)" CXXFLAGS="$(MFX_CXXFLAGS)" ./configure $(HOSTCONF)
 	cd $< && $(MAKE) install
 	touch $@
-- 
2.26.0.windows.1

